# Aikido CI API Key Rotation Guide

**Date:** October 20, 2025
**Status:** Key rotated, Azure Key Vault update required

---

## Summary

The Aikido CI API key has been rotated. The new key is stored in local .env files but needs to be updated in Azure Key Vault for CI/CD pipelines to use it.

## Key Details

**Old Key (Revoked):**
```
Aikido CI key ending in ...euBm (revoked October 20, 2025)
```

**New Key (Active):**
```
Aikido CI key ending in ...DRQ9r
(Full key stored in .credentials file - not in Git)
```

---

## Files Already Updated

✅ `portal/.env` - Contains new key
✅ `web/.env` - Needs verification
⏳ `.credentials` - Still shows old key (commented out) - should be updated

---

## Azure Key Vault Update Required

### Step 1: Update Key in Azure Key Vault

The Aikido CI key is stored in Azure Key Vault and referenced by the CI/CD pipelines.

**Key Vault Name:** (from pipeline variables)
**Secret Name:** `AIKIDO-CI-API-KEY`
**New Value:** (Get from .credentials file - AIK_CI key)

**Via Azure CLI:**
```bash
# Set variables
KEY_VAULT_NAME="your-keyvault-name"  # Check pipeline variable $(keyVaultName)
NEW_AIKIDO_KEY="<get-from-credentials-file>"  # AIK_CI value

# Login to Azure
az login

# Update the secret
az keyvault secret set \
  --vault-name "$KEY_VAULT_NAME" \
  --name "AIKIDO-CI-API-KEY" \
  --value "$NEW_AIKIDO_KEY"

# Verify the update
az keyvault secret show \
  --vault-name "$KEY_VAULT_NAME" \
  --name "AIKIDO-CI-API-KEY" \
  --query "value" -o tsv
```

**Via Azure Portal:**
1. Navigate to Azure Portal: https://portal.azure.com
2. Search for your Key Vault (likely `kv-ctn-demo-asr-dev` or similar)
3. Go to **Secrets** in the left menu
4. Click on **AIKIDO-CI-API-KEY**
5. Click **+ New Version**
6. Paste the new key value from .credentials file (AIK_CI key)
7. Click **Create**

---

## Pipelines That Use This Key

The following pipelines pull `AIKIDO-CI-API-KEY` from Azure Key Vault:

1. **Admin Portal Pipeline**
   - File: `.azure-pipelines/admin-portal.yml`
   - Uses: `$(AIKIDO-CI-API-KEY)` for Aikido security scans
   - Will automatically use new key after Key Vault update

2. **Member Portal Pipeline**
   - File: `.azure-pipelines/member-portal.yml`
   - Uses: `$(AIKIDO-CI-API-KEY)` for Aikido security scans
   - Will automatically use new key after Key Vault update

---

## Verification

After updating Azure Key Vault:

1. **Trigger a build** for Admin or Member portal
2. **Check the Aikido scan step** in the pipeline logs
3. **Expected output:** Aikido scan completes successfully with new API key
4. **If it fails:** Check that the Key Vault secret was updated correctly

---

## Local Development

For local development, the new key is already configured in:
- `portal/.env`
- `web/.env` (verify this file has the new key)

---

## Other Aikido Credentials

The following Aikido credentials are also in use (not rotated):

- **Client ID:** Aikido Client ID ending in ...BN8J (stored in .credentials)
- **Secret Key:** Aikido Secret Key ending in ...XCGZ (stored in .credentials)

These may need to be rotated in the future if they were also exposed.

---

## Next Steps

1. ✅ New key generated by user
2. ⏳ **Update Azure Key Vault secret** (manual step required)
3. ⏳ Update `.credentials` file to reflect new key
4. ⏳ Verify next pipeline run uses new key successfully

---

## Security Notes

- The old key should be considered compromised and must not be used
- The new key should only be stored in:
  - Azure Key Vault (for CI/CD)
  - Local `.env` files (gitignored)
  - `.credentials` file (gitignored)
- Never commit Aikido keys to Git
- Rotate keys regularly (every 90 days recommended)

---

## References

- Aikido Console: https://app.aikido.dev/
- Azure Key Vault Documentation: https://docs.microsoft.com/en-us/azure/key-vault/
- Pipeline Files: `.azure-pipelines/admin-portal.yml`, `.azure-pipelines/member-portal.yml`
