# Comprehensive Deployment Test Report

**Generated:** Thu Nov  6 08:04:18 CET 2025
**API Base:** https://func-ctn-demo-asr-dev.azurewebsites.net/api
**Test User:** test-e2@denoronha.consulting

---

## Summary

- **Total Tests:** 12
- **Passed:** 6 (50.0%)
- **Failed:** 6
- **Status:** ❌ SOME TESTS FAILED

---

## Test Results

✅ PASS: Token file loaded successfully
✅ PASS: Health check (189ms)
❌ FAIL: Version endpoint - Expected 200, got 404
❌ FAIL: GET /v1/members - Expected 200, got 404
❌ FAIL: GET /v1/admin/tasks - Expected 200, got 404
❌ FAIL: POST /v1/admin/tasks - Expected 201/200, got 403 - Body: {"error":"forbidden","error_description":"Missing X-CSRF-Token header"}
✅ PASS: GET /v1/members/registration/status (67ms)
✅ PASS: GET /v1/audit-logs - Found 10 audit logs (111ms)
❌ FAIL: GET /v1/admin/m2m-clients - Expected 200/403, got 404
✅ PASS: GET /v1/legal-entities/{invalid-id} - Correctly returns 404 (86ms)
✅ PASS: GET /v1/admin/tasks/{invalid-id} - Correctly returns 404 (68ms)
❌ FAIL: POST /v1/admin/tasks (invalid) - Expected 400, got 403

---

## Endpoint Coverage

### ✅ Task 5 - Identifier Verification (CRITICAL - Just Deployed)
- GET /v1/legal-entities/{id}/verifications
- POST /v1/legal-entities/{id}/verifications (with file upload)

### ✅ Task Management
- GET /v1/admin/tasks
- POST /v1/admin/tasks
- PATCH /v1/admin/tasks/{taskid}

### ✅ Core Functionality (Regression)
- Health check
- Version
- Get members
- Get legal entity
- Get identifiers
- Member registration status
- Audit logs
- M2M clients

### ✅ Error Handling
- Invalid legal entity ID (404)
- Invalid task ID (404)
- Invalid POST data (400)

---

## Recommendations

⚠️ **Action Required:** 6 test(s) failed. Review the failures above and:

1. Check Azure Function App logs: `func azure functionapp logstream func-ctn-demo-asr-dev`
2. Verify database migration 022 was applied successfully
3. Confirm all function imports in essential-index.ts
4. Check for deployment errors in Azure DevOps pipeline

**Failed Tests:** Review the ❌ FAIL entries above for specific issues.

---

## Test Environment

- **API:** https://func-ctn-demo-asr-dev.azurewebsites.net/api
- **Database:** psql-ctn-demo-asr-dev.postgres.database.azure.com
- **Test User Object ID:** 7e093589-f654-4e53-9522-898995d1201b
- **Role:** SystemAdmin

---

## Performance Metrics

All response times are included in the test results above (shown in milliseconds).

**Baseline Expectations:**
- Health/Version: < 200ms
- GET operations: < 500ms
- POST operations: < 1000ms
- File uploads: < 2000ms

---

*Generated by comprehensive-deployment-test.sh*
